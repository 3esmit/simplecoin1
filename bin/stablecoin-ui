#!/usr/bin/env node
var express = require("express")
var morgan = require("morgan")

var PORT = process.env.PORT || 80
var URL = `http://localhost:${PORT}`

var app = express()
app.use(express.static("public"))
app.use(morgan("dev"))

var env = {
  ETH_ENV:      process.env.ETH_ENV      || "morden",
  ETH_RPC_PORT: process.env.ETH_RPC_PORT || 8545,
}

app.get("/env", (req, res) => res.json(env))

var geth = ["geth"]
if (env.ETH_ENV == "morden") geth.push("--testnet")
geth.push("--rpc")
geth.push(`--rpcport=${env.ETH_RPC_PORT}`)
geth.push(`--rpccorsdomain=${URL}`)

app.listen(PORT, () => {
  console.log()
  console.log(`Serving stablecoin UI at <${URL}>.`)
  console.log("Use `.env.local' to change app environment:")
  console.log()
  for (var key in env) console.log(`   ${key}=${env[key]}`)
  console.log()
  console.log(`Please run geth(1) with a command like this:`)
  console.log()
  console.log(`   ${geth.join(" ")}`)
  console.log()
})
