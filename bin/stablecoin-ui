#!/usr/bin/env node
var express = require("express")
var morgan = require("morgan")

var PORT = process.env.PORT || 80
var URL = `http://localhost:${PORT}`

var env = {}
for (var key in process.env) {
  if (/^APP_/.test(key)) {
    env[key] = process.env[key]
  }
}

function getenv(name) {
  if (name in env) return env[name]
  console.error(`Missing environment variable: ${name}`)
  process.exit(1)
}

var geth = ["geth"]
if (getenv("APP_ENV") == "morden") geth.push("--testnet")
geth.push("--rpc")
geth.push(`--rpcport=${getenv("APP_RPC_PORT")}`)
geth.push(`--rpccorsdomain=${URL}`)

var app = express()
app.use(express.static("public"))
app.use(morgan("dev"))

app.get("/env", (req, res) => res.json(env))

app.listen(PORT, () => {
  console.log()
  console.log(`Serving stablecoin UI at <${URL}>.`)
  console.log()
  for (var key in env) console.log(`   ${key}=${env[key]}`)
  console.log()
  console.log(`Please run geth(1) with a command like this:`)
  console.log()
  console.log(`   ${geth.join(" ")}`)
  console.log()
})
